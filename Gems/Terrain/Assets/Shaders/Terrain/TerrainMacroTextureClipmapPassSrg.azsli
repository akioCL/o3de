/*
 * Copyright (c) Contributors to the Open 3D Engine Project.
 * For complete copyright and license terms please see the LICENSE at the root of this distribution.
 *
 * SPDX-License-Identifier: Apache-2.0 OR MIT
 *
 */

#pragma once

#include <Atom/Features/SrgSemantics.azsli>
#include <TerrainSrg.azsli>
#include <TerrainMaterialSrg.azsli>

ShaderResourceGroup PassSrg : SRG_PerPass_WithFallback
{
    struct ClipmapData
    {
        // The view position where the main camera is.
        float3 m_previousViewPosition;
        [[pad_to(16)]]
        float3 m_currentViewPosition;
        [[pad_to(32)]]

        // World bounds defined by the terrain.
        float3 m_worldBoundsMin;
        [[pad_to(48)]]
        float3 m_worldBoundsMax;
        [[pad_to(64)]]

        // The max range that the clipmap is covering.
        float3 m_maxRenderSize;

        // Each bit indicates the owner clipmap should be fully renewed,
        // possibly caused by starting up or completely moving out of the previous boundaries.
        uint m_fullUpdateFlag;

        // Clipmap ceneters in normalized UV coordinates [0, 1].
        // xy represent previous clipmap centers, zw represent current clipmap centers.
        // (Array elements will always be padded to 16, a float4 size. Storing both centers in float4 saves bandwidth.)
        // They are used for toroidal addressing and may move each frame based on the view point movement.
        // The move distance is scaled differently in each layer.
        float4 m_clipmapCenters[5];
    };

    ClipmapData m_clipmapData;

    RWTexture2D<float4> m_macroColorClipmaps[4];
    RWTexture2D<float4> m_macroColorClipmapPyramid;
    RWTexture2D<float4> m_macroNormalClipmaps[4];
    RWTexture2D<float4> m_macroNormalClipmapPyramid;
}
